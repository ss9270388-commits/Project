include <stdio.h>     // for input/output functions (printf, scanf, fgets)
#include <time.h>      // for system time functions (time, localtime, struct tm)
#include <string.h>    // for string handling (strlen, strcspn, snprintf)
#include <ctype.h>     // for character handling (tolower)


#ifdef _WIN32
    #include <windows.h>
    #define CLEAR() system("cls")
    #define PAUSE_1S() Sleep(1000)
    #define BEEP() Beep(1000, 300)
#else
    #include <unistd.h>
    #define CLEAR() system("clear")
    #define PAUSE_1S() sleep(1)
    #define BEEP() printf("\a")
#endif

#define MAX_TASKS 20

typedef struct {
    char name[100];
    int hour24, minute;
    int reminded;
} Task;

int to_24h(int h12, const char *ampm) {
    return (tolower(ampm[0]) == 'a') ? (h12 == 12 ? 0 : h12) : (h12 == 12 ? 12 : h12 + 12);
}

void show_clock(void) {
    time_t now = time(NULL);
    struct tm *t = localtime(&now);
    const char *days[] = {"Sun","Mon","Tue","Wed","Thu","Fri","Sat"};
    printf("\n=== Digital Clock ===\n%02d-%02d-%04d (%s)\n%02d:%02d:%02d\n=====================\n",
           t->tm_mday, t->tm_mon+1, t->tm_year+1900, days[t->tm_wday],
           t->tm_hour, t->tm_min, t->tm_sec);
}

void show_tasks(Task tasks[], int n) {
    time_t now = time(NULL);
    struct tm *t = localtime(&now);
    int current = t->tm_hour*3600 + t->tm_min*60 + t->tm_sec;

    for (int i=0;i<n;i++) {
        int taskTime = tasks[i].hour24*3600 + tasks[i].minute*60;
        int diff = taskTime - current;
        if (diff < 0) diff += 86400; // next day rollover

        if (diff == 0 && !tasks[i].reminded) {
            printf("Reminder: %s at %02d:%02d\n", tasks[i].name, tasks[i].hour24, tasks[i].minute);
            BEEP(); tasks[i].reminded = 1;
        } else if (diff == 0) {
            printf("Task: %-15s | Happening now\n", tasks[i].name);
        } else {
            printf("Task: %-15s | At %02d:%02d | Starts in %02d:%02d:%02d\n",
                   tasks[i].name, tasks[i].hour24, tasks[i].minute,
                   diff/3600, (diff%3600)/60, diff%60);
            if (tasks[i].reminded && diff > 60) tasks[i].reminded = 0;
        }
    }
}

int main(void) {
    Task tasks[MAX_TASKS];
    int n;

    printf("How many tasks (1-%d)? ", MAX_TASKS);
    if (scanf("%d",&n)!=1 || n<1 || n>MAX_TASKS) return 1;
    getchar(); // clear newline

    for (int i=0;i<n;i++) {
        printf("Enter task %d name: ", i+1);
        fgets(tasks[i].name, sizeof(tasks[i].name), stdin);
        tasks[i].name[strcspn(tasks[i].name,"\n")] = 0;
        if (!tasks[i].name[0]) sprintf(tasks[i].name,"Task %d",i+1);

        int h12,m; char ampm[3];
        do {
            printf("Enter time for \"%s\" (HH MM AM/PM): ", tasks[i].name);
        } while (scanf("%d %d %2s",&h12,&m,ampm)!=3 || h12<1||h12>12||m<0||m>59);
        getchar();
        tasks[i].hour24 = to_24h(h12,ampm);
        tasks[i].minute = m;
        tasks[i].reminded = 0;
    }

    while (1) {
        CLEAR();
        show_clock();
        show_tasks(tasks,n);
        PAUSE_1S();
    }
    return 0;
}
